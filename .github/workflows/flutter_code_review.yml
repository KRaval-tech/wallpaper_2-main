name: Flutter Code Review

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  code_review:
    name: Run Flutter Code Review
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ›  Checkout Repository
        uses: actions/checkout@v4  # Updated to latest version

      - name: ðŸš€ Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: 3.x
          cache: true

      - name: ðŸ“¦ Install Dependencies
        run: flutter pub get

      - name: ðŸ” Run Flutter Analyze
        run: flutter analyze > flutter_analyze_report.txt

      - name: ðŸ›  Run Dart Code Metrics
        run: |
          dart pub global activate dart_code_metrics
          dart run dart_code_metrics:metrics analyze lib > dart_metrics_report.txt

      - name: ðŸ“Š Run Flutter Code Metrics (Cyclomatic Complexity)
        run: |
          dart pub global activate flutter_metrics
          flutter_metrics analyze lib > flutter_metrics_report.txt

      - name: âš¡ Check for Performance & Security Issues
        run: |
          dart run dart_code_metrics:metrics check-unused-code lib > unused_code_report.txt
          dart run dart_code_metrics:metrics check-unnecessary-nullable lib > unnecessary_nullable_report.txt

      - name: ðŸ“œ Merge Reports into One
        run: |
          cat flutter_analyze_report.txt dart_metrics_report.txt flutter_metrics_report.txt unused_code_report.txt unnecessary_nullable_report.txt > code_review_report.txt

      - name: ðŸ“‚ Upload Code Review Report as Artifact
        uses: actions/upload-artifact@v4  # âœ… Updated to latest version
        with:
          name: Code Review Report
          path: code_review_report.txt
